(function($){var settings={errorClass:"validator_error",scrollToFirstError:true,scrollToFirstElementTime:1e3,scrollToFirstElementOffset:0,debug:false,dataDynamicRevalidate:false,validationSummary:false,validationSummaryControl:"",visibleFieldsOnly:true};var validators={data_required:"data-required",data_only_numbers:"data-only-numbers",data_date_format:"data-date-format",data_select_value_different:"data-select-value-different",data_iban:"data-iban",data_email:"data-email",data_disable_validation:"data-disable-validation",data_radio_selected:"data-radio-selected"};var validation_ok=true;var firstErrorControlToScroll=null;var ERROR_MSG_TAG="_error_msg_";var active_validators=new Array;$.fn.initialize=function(options){this.settings=$.extend(settings,options);this.registerAllValidators();if(settings.dataDynamicRevalidate){if(settings.visibleFieldsOnly){this.find("input,select,textarea:visible").each(function(){if(settings.debug)console.log("------------- #"+$(this).attr("id")+" ------------------");$(this).blur(function(){console.log(" >> BLUR: "+$(this).attr("id"));$(this).validateField(this.settings)})})}else{this.find("input,select,textarea").each(function(){if(settings.debug)console.log("------------- #"+$(this).attr("id")+" ------------------");$(this).blur(function(){console.log(" >> BLUR: "+$(this).attr("id"));$(this).validateField(this.settings)})})}}};$.fn.validate=function(){validation_ok=true;firstErrorControlToScroll=null;if(settings.validationSummary){$("#"+settings.validationSummaryControl).empty();$("#"+settings.validationSummaryControl).hide()}if(settings.visibleFieldsOnly){this.find("input:visible,select:visible,textarea:visible").each(function(){$(this).validateField(this.settings)})}else{this.find("input,select,textarea").each(function(){$(this).validateField(this.settings)})}if(settings.scrollToFirstError&&firstErrorControlToScroll!=null){if(settings.validationSummary&&settings.validationSummary!=""){firstErrorControlToScroll=$("#"+settings.validationSummaryControl);firstErrorControlToScroll.show()}$("html, body").animate({scrollTop:firstErrorControlToScroll.offset().top-settings.scrollToFirstElementOffset},settings.scrollToFirstElementTime)}return validation_ok};$.fn.registerAllValidators=function(){this.registerValidator(validators.data_required,function(control){var validator_name=validators.data_required;if(control.attr(validator_name)!=null){if(control.isEmpty())return false;else return true}});this.registerValidator(validators.data_only_numbers,function(control){var validator_name=validators.data_only_numbers;if(control.attr(validator_name)!=null){if(control.isEmpty()||control.isNumeric(control.val())){return true}else{return false}}});this.registerValidator(validators.data_date_format,function(control){var validator_name=validators.data_date_format;if(control.attr(validator_name)!=null){var dateFormat=control.attr(validator_name);var stringDate=control.val();var separator=control.attr(validator_name+"-separator");var dateok=true;try{dateok=$(this).checkDateDMY(stringDate);stringDate=$(this).parseDate(stringDate,dateFormat,separator)}catch(e){dateok=false;alert(e)}if(!control.isEmpty()&&!dateok){return false}else{return true}}});this.registerValidator(validators.data_select_value_different,function(control){var validator_name=validators.data_select_value_different;if(control.attr(validator_name)!=null){if(control.prop("selectedIndex")!=control.attr(validator_name)){return true}else{return false}}});this.registerValidator(validators.data_iban,function(control){var validator_name=validators.data_iban;if(control.attr(validator_name)!=null){if(!control.isEmpty()&&!control.validateIBAN(control.val())){return false}else return true}});this.registerValidator(validators.data_email,function(control){var validator_name=validators.data_email;if(control.attr(validator_name)!=null){if(!control.isEmpty()&&!control.isEmail()){return false}else return true}});this.registerValidator(validators.data_radio_selected,function(control){var validator_name=validators.data_radio_selected;if(control.attr(validator_name)!=null){if(settings.debug)console.log("   Selected elements: "+$("#"+control.attr("id")+":checked").length);if($("#"+control.attr("id")+":checked").length>0){return true}else return false}})};$.fn.registerValidator=function(validator_name,validator_function){active_validators[validator_name]=validator_function};$.fn.manageValidateResponse=function(validator_name,validation_result,control){if(!validation_result){control.showError(control,validator_name)}else{$(this).hideError(control,validator_name)}};$.fn.validateField=function(options){var field_ok=true;if(options!=null)this.settings=$.extend(settings,options);if(settings.debug)console.log("------------- #"+$(this).attr("id")+" ------------------");if($(this).attr(validators.data_disable_validation)!=null)return true;for(validator_name in active_validators){if(settings.debug)console.log("** Validator "+validator_name+" active: "+($(this).attr(validator_name)!=null?"true":"false"));if($(this).attr(validator_name)==null)continue;var ok=active_validators[validator_name]($(this));field_ok&=ok;if(settings.debug)console.log("    Validation isValid: ["+ok+"] Global field validator: ["+field_ok+"]");this.manageValidateResponse(validator_name,ok,$(this))}return field_ok};$.fn.showError=function(element,validator_name){if(settings.debug)console.log("    ShowError: "+validator_name);validation_ok&=false;var id=element.attr("id")+ERROR_MSG_TAG+validator_name;var message=element.attr(validator_name+"-msg");var controlMessage=element.attr("data-message-control");if(message==null)return;if(settings.scrollToFirstError&&firstErrorControlToScroll==null){firstErrorControlToScroll=element}if(controlMessage!=null){$("#"+controlMessage).html(message);$("#"+controlMessage).show();return}if(settings.validationSummary){var errors=$("#"+settings.validationSummaryControl).html();errors+="<span id='"+id+"' class='"+settings.errorClass+"'>"+message+"</span><br/>";$("#"+settings.validationSummaryControl).html(errors);$("#"+settings.validationSummaryControl).show();return}if($("#"+id).length==0){element.after("<span id='"+id+"' class='"+settings.errorClass+"'>"+message+"</span>")}else element.parent("#"+id).show()};$.fn.hideError=function(element,validator_name){if(settings.debug)console.log("    HideError: "+validator_name);var controlMessage=element.attr("data-message-control");if(controlMessage!=null){$("#"+controlMessage).html("");$("#"+controlMessage).hide();return}var id=element.attr("id")+ERROR_MSG_TAG+validator_name;validation_ok&=true;if($("#"+id).length>0){$("#"+id).remove()}};$.fn.isNumeric=function(strString){strString=$.trim(strString);var strValidChars="0123456789,.-";var strChar;var blnResult=true;if(strString.length==0)return false;for(i=0;i<strString.length&&blnResult==true;i++){strChar=strString.charAt(i);if(strValidChars.indexOf(strChar)==-1){blnResult=false}}return blnResult};$.fn.isEmpty=function(){return $.isEmpty($(this).val())};$.isEmpty=function(str){if($.trim(str)=="")return true;return false};$.fn.isEmail=function(){return $.isEmail($(this).val())};$.isEmail=function(str){var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return str.match(re)};$.fn.replaceAll=function(text,replace,replacewith){while(text.toString().indexOf(replace)!=-1)text=text.toString().replace(replace,replacewith);return text};$.fn.validateIBAN=function(IBAN){IBAN=IBAN.toUpperCase();IBAN=$.trim(IBAN);IBAN=IBAN.replace(/\s/g,"");IBAN=IBAN.replace(/\-/g,"");var letra1,letra2,num1,num2;var isbanaux;var numeroSustitucion;var resto;if(IBAN.length>34||IBAN.length<5){return false}var codigoPais=IBAN.substring(0,2).toUpperCase();var digitoControl=IBAN.substring(2,4);var numeroCuenta=IBAN.substring(4).toUpperCase();var numCuenta=numeroCuenta+codigoPais+"00";var Modulus=this.IBANCleaner(numCuenta);if(98-this.ModuloIBAN(Modulus,97)!=parseInt(digitoControl)){return false}return true};$.fn.ModuloIBAN=function(sModulus,divisor){var iStart,iEnde,iErgebniss,iRestTmp,iBuffer;var iRest="",sErg="";iStart=0;iEnde=0;while(iEnde<=sModulus.length-1){iBuffer=parseInt(iRest+sModulus.substring(iStart,iEnde+1));if(iBuffer>=divisor){iErgebniss=Math.floor(iBuffer/divisor);iRestTmp=iBuffer-iErgebniss*divisor;iRest=iRestTmp;iStart=iEnde+1;iEnde=iStart}else{iEnde=iEnde+1}}if(iStart<=sModulus.length)iRest=iRest+sModulus.substring(iStart);return parseInt(iRest)};$.fn.IBANCleaner=function(sIBAN){ls_letras="ABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var x=0;x<ls_letras.length;x++){var replacewith=ls_letras.search(ls_letras[x])+10;var replace=ls_letras[x].toString();sIBAN=this.replaceAll(sIBAN,replace,replacewith.toString())}return sIBAN};$.fn.checkDateDMY=function(dateString){try{var reg=/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/;if(!dateString.match(reg))return false;var sdate=dateString.split("/");var d=parseInt(sdate[0],10),m=parseInt(sdate[1],10),y=parseInt(sdate[2],10);if(d<=0||d>31)return false;if(m<=0||m>12)return false;if(y<=0||y>9999)return false;return true}catch(e){return false}};$.fn.parseDate=function(dateString,format,dateSeparator){var formatParts=format.split(dateSeparator);var dateParts=dateString.split(dateSeparator);var day,month,year;if(formatParts[0].indexOf("d")>-1)day=dateParts[0];if(formatParts[1].indexOf("d")>-1)day=dateParts[1];if(formatParts[2].indexOf("d")>-1)day=dateParts[2];if(formatParts[0].indexOf("M")>-1)month=dateParts[0];if(formatParts[1].indexOf("M")>-1)month=dateParts[1];if(formatParts[2].indexOf("M")>-1)month=dateParts[2];month--;if(formatParts[0].indexOf("y")>-1)year=dateParts[0];if(formatParts[1].indexOf("y")>-1)year=dateParts[1];if(formatParts[2].indexOf("y")>-1)year=dateParts[2];return new Date(year,month,day)}})(jQuery);